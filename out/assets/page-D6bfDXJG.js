import{a as G,u as J,r,j as e,L as l}from"./index-C3--GnAp.js";import{s as m}from"./supabase-KAXpo3yM.js";import"./kakao-lIUS1Y1u.js";import{u as K}from"./useCart-LIK69JhF.js";import"./authStore-Cz-qJVyn.js";const ce=()=>{const[j]=G();J();const[k,y]=r.useState(null),[N,_]=r.useState([]),[u,D]=r.useState([]),[Q,L]=r.useState([]),[W,$]=r.useState(!0),[n,h]=r.useState("all"),[X,Y]=r.useState(null),[Z,T]=r.useState(null),[ee,se]=r.useState(new Set),[o,P]=r.useState(""),[g,E]=r.useState(!1),[p,v]=r.useState("grid"),[f,q]=r.useState("newest"),[d,w]=r.useState(""),[i,b]=r.useState({min:"",max:""}),[x,B]=r.useState([]),{cartItems:F,addToCart:A}=K(),S=F.length,R=()=>{let s=[...u];switch(n!=="all"&&(s=s.filter(t=>t.category_id===n)),o&&(s=s.filter(t=>t.title.toLowerCase().includes(o.toLowerCase())||t.artist.toLowerCase().includes(o.toLowerCase()))),d&&(s=s.filter(t=>t.difficulty===d)),i.min&&(s=s.filter(t=>t.price>=Number(i.min))),i.max&&(s=s.filter(t=>t.price<=Number(i.max))),f){case"newest":s.sort((t,a)=>new Date(a.created_at).getTime()-new Date(t.created_at).getTime());break;case"popular":s.sort((t,a)=>(a.purchase_count||0)-(t.purchase_count||0));break;case"price-low":s.sort((t,a)=>t.price-a.price);break;case"price-high":s.sort((t,a)=>a.price-t.price);break}B(s)};r.useEffect(()=>{I(),U()},[]),r.useEffect(()=>{const s=j.get("category");s&&h(s)},[j]),r.useEffect(()=>{V(),R()},[u,n,o,d,f,i]);const I=async()=>{try{const{data:{user:s}}=await m.auth.getUser();y(s)}catch(s){console.error("Auth check failed:",s)}},M=async()=>{try{await m.auth.signOut(),y(null)}catch(s){console.error("Logout failed:",s)}},U=async()=>{try{await Promise.all([H(),O()])}catch(s){console.error("Data loading error:",s)}finally{$(!1)}},H=async()=>{try{const{data:s,error:t}=await m.from("categories").select("*").order("name");if(t)throw t;_(s??[])}catch(s){console.error("Category loading error:",s)}},O=async()=>{try{const{data:s,error:t}=await m.from("drum_sheets").select("*, categories (name)").order("created_at",{ascending:!1});if(t)throw t;D(s??[])}catch(s){console.error("Drum sheets loading error:",s)}},V=()=>{let s=[...u];n!=="all"&&(s=s.filter(c=>c.category_id===n));const a=s.map(c=>({...c,popularityScore:(c.purchase_count||0)*3+(c.view_count||0)*2+(c.click_count||0)*1})).sort((c,z)=>z.popularityScore-c.popularityScore).slice(0,5);L(a),a.length>0&&T(a[0])},C=async s=>{await A(s)&&alert("장바구니에 추가되었습니다.")};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-8",children:[e.jsx(l,{to:"/",className:"text-2xl font-bold text-blue-600",style:{fontFamily:'"Pacifico", serif'},children:"logo"}),e.jsxs("nav",{className:"hidden md:flex space-x-8",children:[e.jsx(l,{to:"/",className:"text-gray-700 hover:text-blue-600 transition-colors",children:"홈"}),e.jsx(l,{to:"/categories",className:"text-blue-600 font-medium",children:"카테고리"}),e.jsx(l,{to:"/custom-order",className:"text-gray-700 hover:text-blue-600 transition-colors",children:"맞춤 제작"}),e.jsx(l,{to:"/customer-support",className:"text-gray-700 hover:text-blue-600 transition-colors",children:"고객지원"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"악보 검색...",value:o,onChange:s=>P(s.target.value),className:"pl-10 pr-4 py-2 w-64 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs(l,{to:"/cart",className:"relative p-2 text-gray-700 hover:text-blue-600 transition-colors",children:[e.jsx("i",{className:"ri-shopping-cart-line w-5 h-5"}),S>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:S})]}),k?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(l,{to:"/mypage",className:"text-gray-700 hover:text-blue-600 transition-colors",children:"마이페이지"}),e.jsx("button",{onClick:M,className:"text-gray-700 hover:text-blue-600 transition-colors",children:"로그아웃"})]}):e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(l,{to:"/login",className:"text-gray-700 hover:text-blue-600 transition-colors",children:"로그인"}),e.jsx(l,{to:"/register",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap",children:"회원가입"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"드럼 악보 카테고리"}),e.jsx("p",{className:"text-gray-600",children:"원하는 장르와 스타일의 드럼 악보를 찾아보세요"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>E(!g),className:"flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("i",{className:"ri-filter-line w-4 h-4"}),e.jsx("span",{children:"필터"}),e.jsx("i",{className:`ri-arrow-${g?"up":"down"}-s-line w-4 h-4`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"보기:"}),e.jsx("button",{onClick:()=>v("grid"),className:`p-2 rounded-lg transition-colors ${p==="grid"?"bg-blue-100 text-blue-600":"text-gray-400 hover:text-gray-600"}`,children:e.jsx("i",{className:"ri-grid-line w-4 h-4"})}),e.jsx("button",{onClick:()=>v("list"),className:`p-2 rounded-lg transition-colors ${p==="list"?"bg-blue-100 text-blue-600":"text-gray-400 hover:text-gray-600"}`,children:e.jsx("i",{className:"ri-list-unordered w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:f,onChange:s=>q(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm pr-8",children:[e.jsx("option",{value:"newest",children:"최신순"}),e.jsx("option",{value:"popular",children:"인기순"}),e.jsx("option",{value:"price-low",children:"가격 낮은순"}),e.jsx("option",{value:"price-high",children:"가격 높은순"}),e.jsx("option",{value:"rating",children:"평점순"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["총 ",x.length,"개 악보"]})]})]}),g&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"카테고리"}),e.jsxs("select",{value:n,onChange:s=>h(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm pr-8",children:[e.jsx("option",{value:"",children:"전체 카테고리"}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"난이도"}),e.jsxs("select",{value:d,onChange:s=>w(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm pr-8",children:[e.jsx("option",{value:"",children:"전체 난이도"}),e.jsx("option",{value:"beginner",children:"초급"}),e.jsx("option",{value:"intermediate",children:"중급"}),e.jsx("option",{value:"advanced",children:"고급"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"가격 범위"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",placeholder:"최소",value:i.min,onChange:s=>b({...i,min:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),e.jsx("span",{className:"text-gray-500",children:"~"}),e.jsx("input",{type:"number",placeholder:"최대",value:i.max,onChange:s=>b({...i,max:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>{h(""),w(""),b({min:"",max:""})},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"필터 초기화"})})]})]}),p==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:x.map(s=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-shadow group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.thumbnail_url||`https://readdy.ai/api/search-image?query=drum%20sheet%20music%20$%7Bsheet.title%7D%20modern%20minimalist%20background&width=300&height=200&seq=${s.id}&orientation=landscape`,alt:s.title,className:"w-full h-48 object-cover object-top"}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("button",{onClick:()=>C(s.id),className:"bg-white/90 backdrop-blur-sm text-gray-700 p-2 rounded-full hover:bg-white hover:text-blue-600 transition-all opacity-0 group-hover:opacity-100",children:e.jsx("i",{className:"ri-shopping-cart-line w-4 h-4"})})}),s.difficulty&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s.difficulty==="beginner"?"bg-green-100 text-green-800":s.difficulty==="intermediate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.difficulty==="beginner"?"초급":s.difficulty==="intermediate"?"중급":"고급"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-2 flex-1",children:s.title}),e.jsxs("div",{className:"flex items-center ml-2",children:[e.jsx("i",{className:"ri-star-fill text-yellow-400 w-4 h-4"}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:s.rating||4.5})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[s.price.toLocaleString(),"원"]}),e.jsx(l,{to:`/sheet-detail/${s.id}`,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm whitespace-nowrap",children:"상세보기"})]})]})]},s.id))}):e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("img",{src:s.thumbnail_url||`https://readdy.ai/api/search-image?query=drum%20sheet%20music%20$%7Bsheet.title%7D%20modern%20minimalist%20background&width=120&height=80&seq=${s.id}&orientation=landscape`,alt:s.title,className:"w-24 h-16 object-cover object-top rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsxs("div",{className:"flex items-center space-x-4 ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-star-fill text-yellow-400 w-4 h-4"}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:s.rating||4.5})]}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:[s.price.toLocaleString(),"원"]})]})]}),e.jsx("p",{className:"text-gray-600 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[s.difficulty&&e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s.difficulty==="beginner"?"bg-green-100 text-green-800":s.difficulty==="intermediate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.difficulty==="beginner"?"초급":s.difficulty==="intermediate"?"중급":"고급"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["카테고리: ",N.find(t=>t.id===s.category_id)?.name||"기타"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>C(s.id),className:"bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center space-x-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-shopping-cart-line w-4 h-4"}),e.jsx("span",{children:"장바구니"})]}),e.jsx(l,{to:`/sheet-detail/${s.id}`,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap",children:"상세보기"})]})]})]})]})},s.id))}),x.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-file-music-line text-gray-300 w-16 h-16 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"검색 결과가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"다른 검색어나 필터를 시도해보세요."})]})]})]})};export{ce as default};
//# sourceMappingURL=page-D6bfDXJG.js.map
