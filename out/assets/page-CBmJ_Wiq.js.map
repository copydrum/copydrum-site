{"version":3,"file":"page-CBmJ_Wiq.js","sources":["../../src/pages/custom-orders/page.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport { useAuthStore } from '../../stores/authStore';\n\nconst CustomOrdersPage = () => {\n  const [orders, setOrders] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { user } = useAuthStore();\n\n  useEffect(() => {\n    if (user) {\n      fetchOrders();\n    }\n  }, [user]);\n\n  const fetchOrders = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('custom_orders')\n        .select('*')\n        .eq('user_id', user?.id)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setOrders(data || []);\n    } catch (error) {\n      console.error('Error fetching orders:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDownload = async (order: any) => {\n    if (!order.completed_pdf_url) return;\n\n    // 다운로드 횟수 체크\n    if (order.download_count >= order.max_download_count) {\n      alert('다운로드 횟수를 초과했습니다. 고객센터에 문의해주세요.');\n      return;\n    }\n\n    // 다운로드 만료일 체크\n    if (new Date() > new Date(order.download_expires_at)) {\n      alert('다운로드 기간이 만료되었습니다. 고객센터에 문의해주세요.');\n      return;\n    }\n\n    try {\n      // 다운로드 횟수 증가\n      const { error: updateError } = await supabase\n        .from('custom_orders')\n        .update({ \n          download_count: (order.download_count || 0) + 1 \n        })\n        .eq('id', order.id);\n\n      if (updateError) throw updateError;\n\n      // 파일 다운로드\n      const response = await fetch(order.completed_pdf_url);\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = order.completed_pdf_filename || `${order.song_title}_악보.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      // 상태 새로고침\n      fetchOrders();\n      \n      alert('악보 다운로드가 완료되었습니다.');\n    } catch (error) {\n      console.error('Error downloading file:', error);\n      alert('다운로드에 실패했습니다. 다시 시도해주세요.');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* 상단 네비게이션 */}\n      <nav className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4\">\n          <div className=\"flex justify-between items-center h-16\">\n            <div className=\"flex items-center space-x-8\">\n              <a href=\"/\" className=\"text-xl font-bold text-gray-800\" style={{ fontFamily: '\"Pacifico\", serif' }}>\n                logo\n              </a>\n              <div className=\"hidden md:flex space-x-6\">\n                <a href=\"/\" className=\"text-gray-600 hover:text-gray-800\">홈</a>\n                <a href=\"/categories\" className=\"text-gray-600 hover:text-gray-800\">악보 카테고리</a>\n                <a href=\"/custom-order\" className=\"text-gray-600 hover:text-gray-800\">주문제작</a>\n                <a href=\"/custom-orders\" className=\"text-blue-600 font-medium\">주문제작 신청내역</a>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <a href=\"/cart\" className=\"text-gray-600 hover:text-gray-800\">\n                <i className=\"ri-shopping-cart-line text-xl\"></i>\n              </a>\n              <a href=\"/mypage\" className=\"text-gray-600 hover:text-gray-800\">\n                <i className=\"ri-user-line text-xl\"></i>\n              </a>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      <main className=\"max-w-4xl mx-auto px-4 py-8\">\n        <div className=\"bg-white rounded-lg shadow-md p-6\">\n          <h1 className=\"text-2xl font-bold text-gray-800 mb-6\">주문제작 신청내역</h1>\n\n          {loading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n              <p className=\"text-gray-600 mt-2\">로딩 중...</p>\n            </div>\n          ) : orders.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <i className=\"ri-file-list-3-line text-4xl text-gray-400 mb-4\"></i>\n              <p className=\"text-gray-600\">주문제작 신청내역이 없습니다.</p>\n              <a href=\"/custom-order\" className=\"inline-block mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">\n                주문제작 신청하기\n              </a>\n            </div>\n          ) : (\n            <div className=\"space-y-6\">\n              {orders.map((order) => (\n                <div key={order.id} className=\"border border-gray-200 rounded-lg p-6\">\n                  <div className=\"flex justify-between items-start mb-4\">\n                    <div>\n                      <h3 className=\"text-lg font-semibold text-gray-800\">{order.song_title}</h3>\n                      <p className=\"text-sm text-gray-600\">아티스트: {order.artist}</p>\n                      <p className=\"text-xs text-gray-500\">신청일: {new Date(order.created_at).toLocaleDateString()}</p>\n                    </div>\n                    <span className={`px-3 py-1 rounded-full text-sm font-medium ${\n                      order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :\n                      order.status === 'quote_sent' ? 'bg-blue-100 text-blue-800' :\n                      order.status === 'payment_confirmed' ? 'bg-green-100 text-green-800' :\n                      order.status === 'completed' ? 'bg-purple-100 text-purple-800' :\n                      'bg-gray-100 text-gray-800'\n                    }`}>\n                      {order.status === 'pending' ? '신청완료' :\n                       order.status === 'quote_sent' ? '견적발송' :\n                       order.status === 'payment_confirmed' ? '입금확인' :\n                       order.status === 'completed' ? '제작완료' : order.status}\n                    </span>\n                  </div>\n\n                  <div className=\"mb-4\">\n                    <p className=\"text-sm text-gray-700 mb-2\"><strong>요청사항:</strong></p>\n                    <p className=\"text-sm text-gray-600 bg-gray-50 p-3 rounded\">{order.requirements}</p>\n                  </div>\n\n                  {order.youtube_url && (\n                    <div className=\"mb-4\">\n                      <p className=\"text-sm text-gray-700 mb-2\"><strong>참고 영상:</strong></p>\n                      <a href={order.youtube_url} target=\"_blank\" rel=\"noopener noreferrer\" \n                         className=\"text-blue-600 hover:text-blue-800 text-sm break-all\">\n                        {order.youtube_url}\n                      </a>\n                    </div>\n                  )}\n\n                  {order.admin_reply && (\n                    <div className=\"mb-4 bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400\">\n                      <div className=\"flex items-start\">\n                        <i className=\"ri-admin-line text-blue-600 text-lg mr-2 mt-0.5\"></i>\n                        <div>\n                          <p className=\"text-sm font-medium text-blue-800 mb-1\">관리자 답글</p>\n                          <p className=\"text-sm text-blue-700\">{order.admin_reply}</p>\n                          <p className=\"text-xs text-blue-600 mt-2\">\n                            답글일: {order.updated_at ? new Date(order.updated_at).toLocaleDateString() : '-'}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {order.status === 'completed' && order.completed_pdf_url && (\n                    <div className=\"bg-green-50 p-4 rounded-lg border-l-4 border-green-400\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-start\">\n                          <i className=\"ri-file-download-line text-green-600 text-lg mr-2 mt-0.5\"></i>\n                          <div>\n                            <p className=\"text-sm font-medium text-green-800 mb-1\">완성된 악보</p>\n                            <p className=\"text-sm text-green-700\">{order.completed_pdf_filename}</p>\n                            <div className=\"flex items-center gap-4 mt-2 text-xs text-green-600\">\n                              <span>다운로드: {order.download_count || 0}/{order.max_download_count || 5}회</span>\n                              <span>만료일: {new Date(order.download_expires_at).toLocaleDateString()}</span>\n                            </div>\n                          </div>\n                        </div>\n                        <button\n                          onClick={() => handleDownload(order)}\n                          disabled={\n                            (order.download_count >= order.max_download_count) ||\n                            (new Date() > new Date(order.download_expires_at))\n                          }\n                          className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap\"\n                        >\n                          <i className=\"ri-download-line\"></i>\n                          다운로드\n                        </button>\n                      </div>\n                      \n                      {(order.download_count >= order.max_download_count) && (\n                        <div className=\"mt-3 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-700\">\n                          <i className=\"ri-error-warning-line mr-1\"></i>\n                          다운로드 횟수를 초과했습니다. 추가 다운로드가 필요하시면 고객센터에 문의해주세요.\n                        </div>\n                      )}\n                      \n                      {(new Date() > new Date(order.download_expires_at)) && (\n                        <div className=\"mt-3 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-700\">\n                          <i className=\"ri-time-line mr-1\"></i>\n                          다운로드 기간이 만료되었습니다. 고객센터에 문의해주세요.\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {order.status === 'quote_sent' && (\n                    <div className=\"bg-yellow-50 p-3 rounded-lg border-l-4 border-yellow-400\">\n                      <div className=\"flex items-center\">\n                        <i className=\"ri-information-line text-yellow-600 mr-2\"></i>\n                        <p className=\"text-sm text-yellow-800\">\n                          견적을 확인하시고 입금 후 고객센터로 연락주시면 제작을 시작합니다.\n                        </p>\n                      </div>\n                    </div>\n                  )}\n\n                  {order.status === 'payment_confirmed' && (\n                    <div className=\"bg-blue-50 p-3 rounded-lg border-l-4 border-blue-400\">\n                      <div className=\"flex items-center\">\n                        <i className=\"ri-tools-line text-blue-600 mr-2\"></i>\n                        <p className=\"text-sm text-blue-800\">\n                          입금이 확인되었습니다. 현재 악보 제작 중입니다.\n                        </p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default CustomOrdersPage;"],"names":["CustomOrdersPage","orders","setOrders","useState","loading","setLoading","user","useAuthStore","useEffect","fetchOrders","data","error","supabase","handleDownload","order","updateError","blob","url","jsxs","jsx"],"mappings":"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"}