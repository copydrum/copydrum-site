import{u as F,r as t,j as e,L as a}from"./index-C3--GnAp.js";import{s as w}from"./supabase-KAXpo3yM.js";function A(){const h=F(),[c,v]=t.useState(""),[m,k]=t.useState(""),[u,o]=t.useState(!1),[n,r]=t.useState(""),[p,f]=t.useState(""),[x,S]=t.useState(!1),[P,d]=t.useState(!0);t.useEffect(()=>{(async()=>{try{const s=new URLSearchParams(window.location.hash.substring(1)),l=new URLSearchParams(window.location.search),g=s.get("error"),j=l.get("error"),y=s.get("error_description")||l.get("error_description");if(g||j){g==="access_denied"||j==="access_denied"?y?.includes("otp_expired")||y?.includes("expired")?r("비밀번호 재설정 링크가 만료되었습니다. 새로운 재설정 링크를 요청해주세요."):r("비밀번호 재설정 링크가 유효하지 않습니다. 새로운 재설정 링크를 요청해주세요."):r("비밀번호 재설정 중 오류가 발생했습니다. 다시 시도해주세요."),d(!1);return}const N=s.get("access_token")||l.get("access_token"),E=s.get("refresh_token")||l.get("refresh_token"),L=s.get("type")||l.get("type");if(!N||L!=="recovery"){r("유효하지 않은 비밀번호 재설정 링크입니다. 새로운 재설정 링크를 요청해주세요."),d(!1);return}const{data:C,error:b}=await w.auth.setSession({access_token:N,refresh_token:E||""});if(b){console.error("세션 설정 오류:",b),r("비밀번호 재설정 링크가 만료되었거나 유효하지 않습니다. 새로운 재설정 링크를 요청해주세요."),d(!1);return}C.session?S(!0):r("세션을 설정할 수 없습니다. 새로운 재설정 링크를 요청해주세요.")}catch(s){console.error("토큰 확인 오류:",s),r("비밀번호 재설정 링크 확인 중 오류가 발생했습니다.")}finally{d(!1)}})()},[]);const _=async i=>{if(i.preventDefault(),o(!0),r(""),f(""),c!==m){r("비밀번호가 일치하지 않습니다."),o(!1);return}if(c.length<8){r("비밀번호는 8자 이상이어야 합니다."),o(!1);return}try{const{error:s}=await w.auth.updateUser({password:c});if(s)throw s;f("비밀번호가 성공적으로 변경되었습니다. 새 비밀번호로 로그인해주세요."),setTimeout(()=>{h("/login")},3e3)}catch(s){console.error("비밀번호 변경 오류:",s),s.message.includes("session_not_found")||s.message.includes("invalid_token")?r("세션이 만료되었습니다. 새로운 비밀번호 재설정 링크를 요청해주세요."):r("비밀번호 변경에 실패했습니다. 다시 시도해주세요.")}finally{o(!1)}},T=()=>{h("/auth/forgot-password")};return P?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsx("header",{className:"bg-white shadow-sm border-b fixed top-0 left-0 right-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx(a,{to:"/",className:"flex items-center",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",style:{fontFamily:'"Pacifico", serif'},children:"카피드럼"})}),e.jsxs("nav",{className:"hidden md:flex space-x-8",children:[e.jsx(a,{to:"/",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"홈"}),e.jsx("a",{href:"#",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"악보 카테고리"}),e.jsx("a",{href:"#",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"신규 악보"}),e.jsx("a",{href:"#",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"인기 악보"}),e.jsx("a",{href:"#",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"고객지원"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{className:"text-gray-700 hover:text-gray-900 cursor-pointer",children:e.jsx("i",{className:"ri-search-line text-xl"})}),e.jsx("button",{className:"text-gray-700 hover:text-gray-900 cursor-pointer",children:e.jsx("i",{className:"ri-shopping-cart-line text-xl"})}),e.jsx(a,{to:"/login",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 whitespace-nowrap cursor-pointer",children:"로그인"})]})]})})}),e.jsx("div",{className:"mt-16 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("i",{className:"ri-loader-4-line animate-spin text-4xl text-blue-600"})}),e.jsx("h2",{className:"mt-4 text-2xl font-bold text-gray-900",children:"링크 확인 중..."}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"비밀번호 재설정 링크를 확인하고 있습니다."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsx("header",{className:"bg-white shadow-sm border-b fixed top-0 left-0 right-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx(a,{to:"/",className:"flex items-center",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",style:{fontFamily:'"Pacifico", serif'},children:"카피드럼"})}),e.jsxs("nav",{className:"hidden md:flex space-x-8",children:[e.jsx(a,{to:"/",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"홈"}),e.jsx("a",{href:"#",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"악보 카테고리"}),e.jsx("a",{href:"#",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"신규 악보"}),e.jsx("a",{href:"#",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"인기 악보"}),e.jsx("a",{href:"#",className:"text-gray-700 hover:text-gray-900 font-medium whitespace-nowrap cursor-pointer",children:"고객지원"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{className:"text-gray-700 hover:text-gray-900 cursor-pointer",children:e.jsx("i",{className:"ri-search-line text-xl"})}),e.jsx("button",{className:"text-gray-700 hover:text-gray-900 cursor-pointer",children:e.jsx("i",{className:"ri-shopping-cart-line text-xl"})}),e.jsx(a,{to:"/login",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 whitespace-nowrap cursor-pointer",children:"로그인"})]})]})})}),e.jsxs("div",{className:"mt-16 sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:x?"새 비밀번호 설정":"링크 오류"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:x?"새로운 비밀번호를 입력해주세요.":"비밀번호 재설정 링크에 문제가 있습니다."})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[x?e.jsxs("form",{className:"space-y-6",onSubmit:_,children:[n&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm",children:n}),p&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-md text-sm",children:p}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"새 비밀번호"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"password",name:"password",type:"password",required:!0,value:c,onChange:i=>v(i.target.value),className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"새 비밀번호를 입력하세요 (8자 이상)"})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"8자 이상, 영문, 숫자, 특수문자 조합"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"비밀번호 확인"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,value:m,onChange:i=>k(i.target.value),className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"비밀번호를 다시 입력하세요"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:u,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:u?e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"변경 중..."]}):"비밀번호 변경"})})]}):e.jsxs("div",{className:"text-center space-y-4",children:[n&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm",children:n}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"비밀번호 재설정 링크가 만료되었거나 이미 사용되었습니다. 새로운 재설정 링크를 요청해주세요."}),e.jsx("button",{onClick:T,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 whitespace-nowrap cursor-pointer",children:"새 재설정 링크 요청하기"}),e.jsx(a,{to:"/login",className:"block text-center font-medium text-blue-600 hover:text-blue-500 cursor-pointer",children:"로그인으로 돌아가기"})]})]}),x&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx(a,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500 cursor-pointer",children:"로그인으로 돌아가기"})})]})})]}),e.jsx("footer",{className:"bg-gray-900 text-white py-12 mt-16",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold mb-4",style:{fontFamily:'"Pacifico", serif'},children:"카피드럼"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"전문 드러머를 위한 최고 품질의 드럼 악보를 제공합니다."}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:e.jsx("i",{className:"ri-facebook-fill text-xl"})}),e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:e.jsx("i",{className:"ri-instagram-line text-xl"})}),e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:e.jsx("i",{className:"ri-youtube-fill text-xl"})})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold mb-4",children:"악보 카테고리"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"록 드럼"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"재즈 드럼"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"팝 드럼"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"메탈 드럼"})})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold mb-4",children:"고객 지원"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"자주 묻는 질문"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"다운로드 가이드"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"환불 정책"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"문의하기"})})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold mb-4",children:"회사 정보"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"회사 소개"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"이용약관"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"개인정보처리방침"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"text-gray-400 hover:text-white cursor-pointer",children:"파트너십"})})]})]})]}),e.jsx("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center",children:e.jsxs("p",{className:"text-gray-400",children:["© 2024 카피드럼. All rights reserved. |",e.jsx("a",{href:"https://readdy.ai/?origin=logo",className:"text-gray-400 hover:text-white ml-1 cursor-pointer",children:"Website Builder"})]})})]})})]})}export{A as default};
//# sourceMappingURL=reset-password-CXKRQQQT.js.map
