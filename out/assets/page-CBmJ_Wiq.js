import{r,j as e}from"./index-C3--GnAp.js";import{s as d}from"./supabase-KAXpo3yM.js";import{u as p}from"./authStore-Cz-qJVyn.js";const N=()=>{const[n,x]=r.useState([]),[m,o]=r.useState(!0),{user:l}=p();r.useEffect(()=>{l&&i()},[l]);const i=async()=>{try{const{data:s,error:t}=await d.from("custom_orders").select("*").eq("user_id",l?.id).order("created_at",{ascending:!1});if(t)throw t;x(s||[])}catch(s){console.error("Error fetching orders:",s)}finally{o(!1)}},u=async s=>{if(s.completed_pdf_url){if(s.download_count>=s.max_download_count){alert("다운로드 횟수를 초과했습니다. 고객센터에 문의해주세요.");return}if(new Date>new Date(s.download_expires_at)){alert("다운로드 기간이 만료되었습니다. 고객센터에 문의해주세요.");return}try{const{error:t}=await d.from("custom_orders").update({download_count:(s.download_count||0)+1}).eq("id",s.id);if(t)throw t;const h=await(await fetch(s.completed_pdf_url)).blob(),c=window.URL.createObjectURL(h),a=document.createElement("a");a.href=c,a.download=s.completed_pdf_filename||`${s.song_title}_악보.pdf`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(c),document.body.removeChild(a),i(),alert("악보 다운로드가 완료되었습니다.")}catch(t){console.error("Error downloading file:",t),alert("다운로드에 실패했습니다. 다시 시도해주세요.")}}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("nav",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-8",children:[e.jsx("a",{href:"/",className:"text-xl font-bold text-gray-800",style:{fontFamily:'"Pacifico", serif'},children:"logo"}),e.jsxs("div",{className:"hidden md:flex space-x-6",children:[e.jsx("a",{href:"/",className:"text-gray-600 hover:text-gray-800",children:"홈"}),e.jsx("a",{href:"/categories",className:"text-gray-600 hover:text-gray-800",children:"악보 카테고리"}),e.jsx("a",{href:"/custom-order",className:"text-gray-600 hover:text-gray-800",children:"주문제작"}),e.jsx("a",{href:"/custom-orders",className:"text-blue-600 font-medium",children:"주문제작 신청내역"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("a",{href:"/cart",className:"text-gray-600 hover:text-gray-800",children:e.jsx("i",{className:"ri-shopping-cart-line text-xl"})}),e.jsx("a",{href:"/mypage",className:"text-gray-600 hover:text-gray-800",children:e.jsx("i",{className:"ri-user-line text-xl"})})]})]})})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"주문제작 신청내역"}),m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"로딩 중..."})]}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-file-list-3-line text-4xl text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"주문제작 신청내역이 없습니다."}),e.jsx("a",{href:"/custom-order",className:"inline-block mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"주문제작 신청하기"})]}):e.jsx("div",{className:"space-y-6",children:n.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.song_title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["아티스트: ",s.artist]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["신청일: ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="quote_sent"?"bg-blue-100 text-blue-800":s.status==="payment_confirmed"?"bg-green-100 text-green-800":s.status==="completed"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:s.status==="pending"?"신청완료":s.status==="quote_sent"?"견적발송":s.status==="payment_confirmed"?"입금확인":s.status==="completed"?"제작완료":s.status})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:e.jsx("strong",{children:"요청사항:"})}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded",children:s.requirements})]}),s.youtube_url&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:e.jsx("strong",{children:"참고 영상:"})}),e.jsx("a",{href:s.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm break-all",children:s.youtube_url})]}),s.admin_reply&&e.jsx("div",{className:"mb-4 bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-admin-line text-blue-600 text-lg mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"관리자 답글"}),e.jsx("p",{className:"text-sm text-blue-700",children:s.admin_reply}),e.jsxs("p",{className:"text-xs text-blue-600 mt-2",children:["답글일: ",s.updated_at?new Date(s.updated_at).toLocaleDateString():"-"]})]})]})}),s.status==="completed"&&s.completed_pdf_url&&e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border-l-4 border-green-400",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-file-download-line text-green-600 text-lg mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800 mb-1",children:"완성된 악보"}),e.jsx("p",{className:"text-sm text-green-700",children:s.completed_pdf_filename}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-green-600",children:[e.jsxs("span",{children:["다운로드: ",s.download_count||0,"/",s.max_download_count||5,"회"]}),e.jsxs("span",{children:["만료일: ",new Date(s.download_expires_at).toLocaleDateString()]})]})]})]}),e.jsxs("button",{onClick:()=>u(s),disabled:s.download_count>=s.max_download_count||new Date>new Date(s.download_expires_at),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-download-line"}),"다운로드"]})]}),s.download_count>=s.max_download_count&&e.jsxs("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-700",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),"다운로드 횟수를 초과했습니다. 추가 다운로드가 필요하시면 고객센터에 문의해주세요."]}),new Date>new Date(s.download_expires_at)&&e.jsxs("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-700",children:[e.jsx("i",{className:"ri-time-line mr-1"}),"다운로드 기간이 만료되었습니다. 고객센터에 문의해주세요."]})]}),s.status==="quote_sent"&&e.jsx("div",{className:"bg-yellow-50 p-3 rounded-lg border-l-4 border-yellow-400",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-information-line text-yellow-600 mr-2"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"견적을 확인하시고 입금 후 고객센터로 연락주시면 제작을 시작합니다."})]})}),s.status==="payment_confirmed"&&e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg border-l-4 border-blue-400",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-tools-line text-blue-600 mr-2"}),e.jsx("p",{className:"text-sm text-blue-800",children:"입금이 확인되었습니다. 현재 악보 제작 중입니다."})]})})]},s.id))})]})})]})};export{N as default};
//# sourceMappingURL=page-CBmJ_Wiq.js.map
