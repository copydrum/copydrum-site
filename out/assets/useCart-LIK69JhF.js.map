{"version":3,"file":"useCart-LIK69JhF.js","sources":["../../src/hooks/useCart.ts"],"sourcesContent":["\nimport { useState, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { useAuthStore } from '../stores/authStore';\n\nexport interface CartItem {\n  id: string;\n  sheet_id: string;\n  title: string;\n  artist: string;\n  price: number;\n  image?: string;\n  category: string;\n}\n\nexport const useCart = () => {\n  const [cartItems, setCartItems] = useState<CartItem[]>([]);\n  const [loading, setLoading] = useState(false);\n  const { user } = useAuthStore();\n\n  // 장바구니 아이템 로드\n  const loadCartItems = async () => {\n    if (!user) return;\n    \n    setLoading(true);\n    try {\n      const { data, error } = await supabase\n        .from('cart_items')\n        .select(`\n          id,\n          sheet_id,\n          created_at,\n          drum_sheets (\n            id,\n            title,\n            artist,\n            price,\n            thumbnail_url,\n            category_id,\n            categories (\n              name\n            )\n          )\n        `)\n        .eq('user_id', user.id);\n\n      if (error) throw error;\n\n      const items = data?.filter(item => item.drum_sheets).map(item => ({\n        id: item.id,\n        sheet_id: item.sheet_id,\n        title: item.drum_sheets!.title,\n        artist: item.drum_sheets!.artist,\n        price: item.drum_sheets!.price,\n        image: item.drum_sheets!.thumbnail_url,\n        category: item.drum_sheets!.categories?.name || '기타'\n      })) || [];\n\n      setCartItems(items);\n    } catch (error) {\n      console.error('장바구니 로드 실패:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // 장바구니에 아이템 추가\n  const addToCart = async (sheetId: string) => {\n    if (!user) {\n      alert('로그인이 필요합니다.');\n      return false;\n    }\n\n    try {\n      const { error } = await supabase\n        .from('cart_items')\n        .insert({\n          user_id: user.id,\n          sheet_id: sheetId\n        });\n\n      if (error) {\n        if (error.code === '23505') {\n          alert('이미 장바구니에 있는 상품입니다.');\n          return false;\n        }\n        throw error;\n      }\n\n      await loadCartItems();\n      return true;\n    } catch (error) {\n      console.error('장바구니 추가 실패:', error);\n      alert('장바구니 추가에 실패했습니다.');\n      return false;\n    }\n  };\n\n  // 장바구니에서 아이템 제거\n  const removeFromCart = async (cartItemId: string) => {\n    if (!user) return false;\n\n    try {\n      const { error } = await supabase\n        .from('cart_items')\n        .delete()\n        .eq('id', cartItemId)\n        .eq('user_id', user.id);\n\n      if (error) throw error;\n\n      await loadCartItems();\n      return true;\n    } catch (error) {\n      console.error('장바구니 제거 실패:', error);\n      return false;\n    }\n  };\n\n  // 선택된 아이템들 제거\n  const removeSelectedItems = async (cartItemIds: string[]) => {\n    if (!user || cartItemIds.length === 0) return false;\n\n    try {\n      const { error } = await supabase\n        .from('cart_items')\n        .delete()\n        .in('id', cartItemIds)\n        .eq('user_id', user.id);\n\n      if (error) throw error;\n\n      await loadCartItems();\n      return true;\n    } catch (error) {\n      console.error('선택 아이템 제거 실패:', error);\n      return false;\n    }\n  };\n\n  // 장바구니 전체 비우기\n  const clearCart = async () => {\n    if (!user) return false;\n\n    try {\n      const { error } = await supabase\n        .from('cart_items')\n        .delete()\n        .eq('user_id', user.id);\n\n      if (error) throw error;\n\n      setCartItems([]);\n      return true;\n    } catch (error) {\n      console.error('장바구니 비우기 실패:', error);\n      return false;\n    }\n  };\n\n  // 장바구니에 있는지 확인\n  const isInCart = (sheetId: string) => {\n    return cartItems.some(item => item.sheet_id === sheetId);\n  };\n\n  // 총 가격 계산\n  const getTotalPrice = (selectedItems?: string[]) => {\n    const items = selectedItems \n      ? cartItems.filter(item => selectedItems.includes(item.id))\n      : cartItems;\n    return items.reduce((total, item) => total + item.price, 0);\n  };\n\n  useEffect(() => {\n    loadCartItems();\n  }, [user]);\n\n  return {\n    cartItems,\n    loading,\n    addToCart,\n    removeFromCart,\n    removeSelectedItems,\n    clearCart,\n    isInCart,\n    getTotalPrice,\n    loadCartItems\n  };\n};\n"],"names":["useCart","cartItems","setCartItems","useState","loading","setLoading","user","useAuthStore","loadCartItems","data","error","supabase","items","item","addToCart","sheetId","removeFromCart","cartItemId","removeSelectedItems","cartItemIds","clearCart","isInCart","getTotalPrice","selectedItems","total","useEffect"],"mappings":"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"}