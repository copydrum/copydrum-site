import{r as l,u as M,j as e,L as S}from"./index-C3--GnAp.js";import{s as p}from"./supabase-KAXpo3yM.js";import{k as z}from"./kakao-lIUS1Y1u.js";import{g as E}from"./google-Bi8GeQwn.js";function L(){const[r,k]=l.useState({name:"",email:"",password:"",confirmPassword:""}),[x,m]=l.useState(!1),[h,g]=l.useState(!1),[b,y]=l.useState(!1),[w,o]=l.useState(""),[j,N]=l.useState(""),f=M(),u=s=>{k({...r,[s.target.name]:s.target.value})},v=async s=>{if(s.preventDefault(),m(!0),o(""),N(""),r.password!==r.confirmPassword){o("비밀번호가 일치하지 않습니다."),m(!1);return}if(r.password.length<6){o("비밀번호는 최소 6자 이상이어야 합니다."),m(!1);return}try{const{data:a,error:t}=await p.auth.signUp({email:r.email,password:r.password,options:{data:{name:r.name}}});if(t)throw t;if(a.user){const{error:n}=await p.from("profiles").insert({id:a.user.id,email:r.email,name:r.name,provider:"email"});n&&console.error("프로필 생성 오류:",n),N("회원가입이 완료되었습니다! 이메일을 확인하여 계정을 활성화해주세요."),setTimeout(()=>{f("/auth/login")},3e3)}}catch(a){console.error("회원가입 오류:",a),a.message.includes("User already registered")?o("이미 등록된 이메일입니다."):a.message.includes("Password should be at least 6 characters")?o("비밀번호는 최소 6자 이상이어야 합니다."):o("회원가입에 실패했습니다. 다시 시도해주세요.")}finally{m(!1)}},I=async()=>{g(!0),o("");try{const{userInfo:s}=await z.login();console.log("카카오 사용자 정보:",s);const a=await fetch("https://tkbyemysfmbhqwdvefsi.supabase.co/functions/v1/social-auth-handler",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRrYnllbXlzZm1iaHF3ZHZlZnNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NDE4MTIsImV4cCI6MjA3NzExNzgxMn0.af-52GM6sXsaMCoMU9MuHckTQ8zf6M2Qc5CM_ReeNHk",Accept:"application/json; charset=utf-8"},body:JSON.stringify({provider:"kakao",userInfo:s})}),t=await a.json();if(!a.ok)throw new Error(t.error||"카카오 로그인 처리 중 오류가 발생했습니다.");if(console.log("카카오 로그인 성공:",t),t.authUrl){const n=new URL(t.authUrl),i=n.searchParams.get("access_token"),c=n.searchParams.get("refresh_token");if(i&&c){const{error:d}=await p.auth.setSession({access_token:i,refresh_token:c});d&&console.error("세션 설정 오류:",d)}}f("/")}catch(s){console.error("카카오 로그인 오류:",s),o(s.message||"카카오 로그인에 실패했습니다.")}finally{g(!1)}},C=async()=>{y(!0),o("");try{const{userInfo:s}=await E.login();console.log("구글 사용자 정보:",s);const a=await fetch("https://tkbyemysfmbhqwdvefsi.supabase.co/functions/v1/social-auth-handler",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRrYnllbXlzZm1iaHF3ZHZlZnNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NDE4MTIsImV4cCI6MjA3NzExNzgxMn0.af-52GM6sXsaMCoMU9MuHckTQ8zf6M2Qc5CM_ReeNHk",Accept:"application/json; charset=utf-8"},body:JSON.stringify({provider:"google",userInfo:s})}),t=await a.json();if(!a.ok)throw new Error(t.error||"구글 로그인 처리 중 오류가 발생했습니다.");if(console.log("구글 로그인 성공:",t),t.authUrl){const n=new URL(t.authUrl),i=n.searchParams.get("access_token"),c=n.searchParams.get("refresh_token");if(i&&c){const{error:d}=await p.auth.setSession({access_token:i,refresh_token:c});d&&console.error("세션 설정 오류:",d)}}f("/")}catch(s){console.error("구글 로그인 오류:",s),o(s.message||"구글 로그인에 실패했습니다.")}finally{y(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-blue-100",children:e.jsx("i",{className:"ri-music-2-line text-2xl text-blue-600"})}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"회원가입"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["또는"," ",e.jsx(S,{to:"/auth/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"기존 계정으로 로그인"})]})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:v,children:[w&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm",children:w}),j&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-md text-sm",children:j}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"이름"}),e.jsx("input",{id:"name",name:"name",type:"text",required:!0,value:r.name,onChange:u,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"이름을 입력하세요"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"이메일 주소"}),e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:r.email,onChange:u,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"이메일을 입력하세요"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"비밀번호"}),e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,value:r.password,onChange:u,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"비밀번호를 입력하세요 (최소 6자)"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"비밀번호 확인"}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,value:r.confirmPassword,onChange:u,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"비밀번호를 다시 입력하세요"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:x,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:x?e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"회원가입 중..."]}):"회원가입"})}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"또는"})})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx("button",{type:"button",onClick:I,disabled:h,className:"w-full flex items-center justify-center py-3 px-4 bg-yellow-400 text-gray-900 rounded-md shadow-sm font-bold text-sm hover:bg-yellow-500 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg mr-2"}),"카카오 로그인 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-kakao-talk-fill text-lg mr-2"}),"카카오톡으로 시작하기"]})}),e.jsx("button",{type:"button",onClick:C,disabled:b,className:"w-full flex items-center justify-center py-3 px-4 bg-white border border-gray-300 text-gray-700 rounded-md shadow-sm font-bold text-sm hover:bg-gray-50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg mr-2"}),"구글 로그인 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-google-fill text-red-500 text-lg mr-2"}),"구글로 시작하기"]})})]})]})]})]})})}export{L as default};
//# sourceMappingURL=register-DncsSgFc.js.map
